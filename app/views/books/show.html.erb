<div class="mx-auto pb-2 stat-label" style="max-width: 1000px;">
  <%= link_to :back, class: "link-body-emphasis link-underline link-underline-opacity-0" do %>
    <i class="fa-solid fa-arrow-left"></i>
    Go back
  <% end %>
</div>
<div class="book-detail-card">
  <div class="book-detail-content">
    <!-- Left: Book Cover & Actions -->
    <div class="book-cover-section">
      <div class="book-cover-large">
        <%= @book.title.upcase %>
      </div>
      
      <div class="action-buttons">
        <%= form_with(model: @user_book, url: @user_book.persisted? ? user_book_path(@user_book) : user_books_path, method: @user_book.persisted? ? :patch : :post) do |form| %>
          <%= form.hidden_field :book_id, value: @book.id %>
          <%= form.hidden_field :status, value: 'read' %>
          <%= form.submit "I've Read", class: "btn-status #{'active' if @user_book.status == 'read'}" %>
        <% end %>

        <%= form_with(model: @user_book, url: @user_book.persisted? ? user_book_path(@user_book) : user_books_path, method: @user_book.persisted? ? :patch : :post) do |form| %>
          <%= form.hidden_field :book_id, value: @book.id %>
          <%= form.hidden_field :status, value: 'want_to_read' %>
          <%= form.submit "Want to Read", class: "btn-status #{'active' if @user_book.status == 'want_to_read'}" %>
        <% end %>
      </div>
    </div>
    
    <!-- Right: Book Info -->
    <div class="book-info-section">
      <div class="book-header">
        <% if @user_book.persisted? %>
          <div class="status-badge">
            ðŸ“š In Your Library
          </div>
        <% end %>
        <h1 class="book-title"><%= @book.title %></h1>
        <p class="book-author">by <%= @book.author %></p>
        <% if @book.genre.present? %>
          <span class="book-genre"><%= @book.genre %></span>
        <% end %>
      </div>
      
      <% if @book.description.present? %>
        <div class="book-description">
          <strong>About this book:</strong><br>
          <%= @book.description %>
        </div>
      <% end %>
      
      <!-- Rating Section -->
      <% if @user_book.persisted? && @user_book.status == 'read' %>
        <div class="rating-section">
          <h3>Your Rating</h3>
          
          <% if @user_book.rating.present? %>
            <div class="rating-display">
              <% @user_book.rating.times do %>
                <span class="star">â˜…</span>
              <% end %>
              <% (5 - @user_book.rating).times do %>
                <span class="star empty">â˜…</span>
              <% end %>
              <span style="margin-left: 0.5rem; color: var(--text-medium);"><%= @user_book.rating %> stars</span>
            </div>
          <% end %>
          
          <%= form_with(model: @user_book, url: user_book_path(@user_book), method: :patch, class: "rating-form") do |form| %>
            <%= form.hidden_field :book_id, value: @book.id %>
            <%= form.hidden_field :status, value: @user_book.status %>
            
            <div class="form-group">
              <%= form.label :rating, "Update your rating" %>
              <%= form.select :rating, 
                  options_for_select([
                    ['No rating', nil],
                    ['â­ 1 star', 1],
                    ['â­â­ 2 stars', 2],
                    ['â­â­â­ 3 stars', 3],
                    ['â­â­â­â­ 4 stars', 4],
                    ['â­â­â­â­â­ 5 stars', 5]
                  ], @user_book.rating),
                  {},
                  class: "form-select" %>
            </div>
            <%= form.submit "Update", class: "btn-rate" %>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<% if @book.readers.where.not(id: Current.user.id).any? %>
  <div class="similar-readers-section">
    <h2 class="section-title">What Readers Think</h2>
    <div class="readers-grid">
      <% @book.readers.where.not(id: Current.user.id).each do |reader| %>
        <%= render "reader", user: reader, book: @book %>
      <% end %>
    </div>
  </div>
<% end %>
